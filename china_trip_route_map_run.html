<!DOCTYPE html>
<html>
<head>
  <title>çµ²è·¯è¡Œç¨‹äº’å‹•åœ°åœ–</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; display: flex; flex-direction: column; height: 100vh; }
    #map { flex: 1; }
    .summary-popup {
      white-space: pre-wrap;
      font-size: 0.9em;
      line-height: 1.4em;
      width: 500px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .summary-labelA-popup {
      white-space: pre-wrap;
      font-size: 0.9em;
      line-height: 1.4em;
      width: 270px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .summary-label:hover div,
    .summary-labelA:hover div {
      background-color: #ffd700;
      transform: scale(0.85);
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([35.5, 105.5], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const locations = [
        { name: "é„­å·", coords: [34.7473, 113.6249], day: "D1, D8â€“D10", note: "D1: æŠµé”é„­å·ï¼Œæ­ä¹˜é«˜éµå‰å¾€å¤©æ°´ã€‚<br>D8: åƒè§€å…µé¦¬ä¿‘ã€é©ªå±±å¾Œè¿”å›é„­å·ã€‚<br>D9: å‰å¾€ç™»å°å°‘æ—å¯ºï¼Œå›é„­å·è‡ªç”±è³¼ç‰©ã€‚<br>D10: é€æ©Ÿè¿”å›å°åŒ—ã€‚<br>ä½å®¿ï¼šé„­å·å»ºåœ‹é£¯åº—ã€‚" },
        { name: "å¤©æ°´", coords: [34.5809, 105.7249], day: "D1â€“D2", note: "D1: é«˜éµæŠµé”å¤©æ°´ã€‚<br>D2: åƒè§€éº¥ç©å±±çŸ³çªŸï¼Œå‰å¾€è˜­å·ã€‚<br>ä½å®¿ï¼šæŸéœ–è‰¾è²é…’åº—ã€‚" },
        { name: "è˜­å·", coords: [36.0611, 103.8343], day: "D2â€“D3", note: "D2: éŠè¦½é»ƒæ²³éŠè¦½å€ï¼Œå¤œå®¿è˜­å·ã€‚<br>D3: å‰å¾€æ™¯æ³°é»ƒæ²³çŸ³æ—ã€‚<br>ä½å®¿ï¼šè˜­å·é»ƒæ²³ç¾è¯é…’åº—ã€‚" },
        { name: "æ™¯æ³°", coords: [37.1477, 104.0658], day: "D3", note: "D3: åƒè§€é»ƒæ²³çŸ³æ—ï¼Œéš¨å¾Œå‰å¾€æ­¦å¨ã€‚<br>ä½å®¿ï¼šé‡‘é™µå¤§é…’åº—ã€‚" },
        { name: "æ­¦å¨", coords: [37.9283, 102.6410], day: "D3â€“D4", note: "D4: å‰å¾€å¼µæ–ï¼Œåƒè§€ä¸ƒå½©ä¸¹éœã€‚<br>ä½å®¿ï¼šå˜‰å³ªé—œè«¾é‡‘é…’åº—ã€‚" },
        { name: "å¼µæ–", coords: [38.9259, 100.4498], day: "D4", note: "D4: åƒè§€ä¸ƒå½©ä¸¹éœï¼Œéš¨å¾Œå‰å¾€å˜‰å³ªé—œã€‚<br>ä½å®¿ï¼šå˜‰å³ªé—œè«¾é‡‘é…’åº—ã€‚" },
        { name: "å˜‰å³ªé—œ", coords: [39.7719, 98.2892], day: "D4â€“D5", note: "D5: åƒè§€å˜‰å³ªé—œåŸæ¨“ï¼Œå‰å¾€ç“œå·ã€‚<br>ä½å®¿ï¼šæ•¦ç…Œä¸­å·åœ‹éš›é…’åº—ã€‚" },
        { name: "ç“œå·", coords: [40.5187, 95.7812], day: "D5", note: "D5: åƒè§€å¤§åœ°ä¹‹å­ã€æµ·å¸‚èœƒæ¨“ï¼Œéš¨å¾Œå‰å¾€æ•¦ç…Œã€‚<br>ä½å®¿ï¼šæ•¦ç…Œä¸­å·åœ‹éš›é…’åº—ã€‚" },
        { name: "æ•¦ç…Œ", coords: [40.1421, 94.6610], day: "D5â€“D7", note: "D5: åƒè§€é™½é—œã€‚<br>D6: åƒè§€è«é«˜çªŸã€é³´æ²™å±±æœˆç‰™æ³‰ï¼Œäº«ç”¨çƒ¤å…¨ç¾Šæ™šé¤ã€‚<br>D7: åƒè§€å¤åŸã€è¥¿åƒä½›æ´ï¼Œæ­æ©Ÿå‰å¾€è¥¿å®‰ã€‚<br>ä½å®¿ï¼šæ•¦ç…Œä¸­å·åœ‹éš›é…’åº—ã€‚" },
        { name: "è¥¿å®‰", coords: [34.3416, 108.9398], day: "D7â€“D8", note: "D7: æŠµé”è¥¿å®‰ã€‚<br>D8: åƒè§€å…µé¦¬ä¿‘ã€é©ªå±±ï¼Œæ­é«˜éµè¿”å›é„­å·ã€‚<br>ä½å®¿ï¼šè¥¿å®‰çµ¡ç¹¹åŠLFYå…±ç”¨å…¬å¯“ã€‚" },
        { name: "ç™»å°", coords: [34.4510, 113.0380], day: "D9", note: "D9: åƒè§€å°‘æ—å¯ºã€å¡”æ—ï¼Œæ¬£è³å°‘æ—åŠŸå¤«è¡¨æ¼”ï¼Œ<br>è¿”å›é„­å·ã€‚<br>ä½å®¿ï¼šé„­å·å»ºåœ‹é£¯åº—ã€‚" }
    ];

    // æ·»åŠ åœ°é»æ¨™è¨˜
    locations.forEach(loc => {
      L.marker(loc.coords).addTo(map).bindPopup(`<b>${loc.name}</b>ï¼ˆ${loc.day}ï¼‰<br>${loc.note}`);
    });

    // ç¹ªè£½é™¸è·¯è·¯ç·š
    const landRoute = locations.slice(1, 9).map(l => l.coords);
    L.polyline(landRoute, { color: 'red', weight: 3 }).addTo(map);

    // ç¹ªè£½é£›è¡Œè·¯ç·š
    function generateArcPoints(start, end, numPoints = 100, arcHeight = 3.2) {
      const points = [];
      for (let i = 0; i <= numPoints; i++) {
        const t = i / numPoints;
        const lat = start[0] + (end[0] - start[0]) * t;
        const lng = start[1] + (end[1] - start[1]) * t;
        const curveLat = lat - arcHeight * Math.sin(Math.PI * t);
        points.push([curveLat, lng]);
      }
      return points;
    }
    const flightPath = generateArcPoints(locations[8].coords, locations[9].coords, 200, 3.2);
    L.polyline(flightPath, { color: 'blue', weight: 3, dashArray: '5, 10', opacity: 0.7 }).addTo(map);

    // å®šç¾©äº¤é€šå·¥å…·åœ–ç¤º
    const trainIcon = L.divIcon({ html: 'ğŸš„', className: 'train-icon', iconSize: [48, 48] });  // Increased size to 48x48
    const busIcon = L.divIcon({ html: 'ğŸšŒ', className: 'bus-icon', iconSize: [48, 48] });    // Increased size to 48x48
    const planeIcon = L.divIcon({ html: 'âœˆï¸', className: 'plane-icon', iconSize: [48, 48] });  // Increased size to 48x48

    // åˆå§‹åŒ–äº¤é€šå·¥å…·æ¨™è¨˜
    let trainMarker1 = null;
    let busMarker1 = null;
    let planeMarker = null;
    let trainMarker2 = null;
    let busMarker2 = null;

    let trainIndex1 = 0, busIndex1 = 0, planeIndex = 0, trainIndex2 = 0, busIndex2 = 0;
    let animationInterval;
    let currentStage = 0;
    let trainSpeed = 3000;
    let busSpeed = 3000;
    let planeSpeed = 6000;
    let trainPath1Points = [];
    let busPathPoints = [];
    let planePathPoints = [];
    let trainPath2Points = [];
    let busPath2Points = [];
    let isAnimating = false;

    function clearMarkers() {
      if (trainMarker1) { map.removeLayer(trainMarker1); trainMarker1 = null; }
      if (busMarker1) { map.removeLayer(busMarker1); busMarker1 = null; }
      if (planeMarker) { map.removeLayer(planeMarker); planeMarker = null; }
      if (trainMarker2) { map.removeLayer(trainMarker2); trainMarker2 = null; }
      if (busMarker2) { map.removeLayer(busMarker2); busMarker2 = null; }
    }

    function generatePoints(path, speed) {
        const points = [];
        let distance = 0;
        for (let i = 0; i < path.length - 1; i++) {
            const start = path[i];
            const end = path[i + 1];
             distance = L.latLng(start).distanceTo(end);
            const numPoints = Math.ceil(distance / speed);
            for (let j = 0; j <= numPoints; j++) {
                const t = j / numPoints;
                const lat = start[0] + (end[0] - start[0]) * t;
                const lng = start[1] + (end[1] - start[1]) * t;
                points.push([lat, lng]);
            }
        }
        return points;
    }

    function startAnimation() {
      if (isAnimating) return;
      isAnimating = true;
      clearInterval(animationInterval);
      currentStage = 0;
      clearMarkers();
      trainIndex1 = 0;
      busIndex1 = 0;
      planeIndex = 0;
      trainIndex2 = 0;
      busIndex2 = 0;
      trainPath1Points = generatePoints(trainPath1, trainSpeed);
      busPathPoints = generatePoints(busPath, busSpeed);
      planePathPoints = generatePoints(smoothFlightPath, planeSpeed);
      trainPath2Points = generatePoints(trainPath2, trainSpeed);
      busPath2Points = generatePoints(busPath2, busSpeed);
      animateStage();
    }

    function animateStage() {
      let speed = 100;
      let currentPoints = [];
      if (currentStage > 4) {
        isAnimating = false;
        return;
      }
      animationInterval = setInterval(() => {
        let stageFinished = true;
        switch (currentStage) {
          case 0:
            speed = trainSpeed;
            currentPoints = trainPath1Points;
            if (!trainMarker1) {
              trainMarker1 = L.marker(locations[0].coords, { icon: trainIcon }).addTo(map);
            }
            if (trainIndex1 < currentPoints.length - 1) {
              trainIndex1++;
              trainMarker1.setLatLng(currentPoints[trainIndex1]);
              stageFinished = false;
            } else {
              map.removeLayer(trainMarker1);
              trainMarker1 = null;
              trainIndex1 = 0;
              currentStage++;
            }
            break;
          case 1:
            speed = busSpeed;
            currentPoints = busPathPoints;
            if (!busMarker1) {
              busMarker1 = L.marker(locations[1].coords, { icon: busIcon }).addTo(map);
            }
            if (busIndex1 < currentPoints.length - 1) {
              busIndex1++;
              busMarker1.setLatLng(currentPoints[busIndex1]);
              stageFinished = false;
            } else {
              map.removeLayer(busMarker1);
              busMarker1 = null;
              busIndex1 = 0;
              currentStage++;
            }
            break;
          case 2:
            speed = planeSpeed;
            currentPoints = planePathPoints;
            if (!planeMarker) {
              planeMarker = L.marker(smoothFlightPath[0], { icon: planeIcon }).addTo(map);
            }
            if (planeIndex < currentPoints.length - 1) {
              planeIndex++;
              planeMarker.setLatLng(currentPoints[planeIndex]);
              stageFinished = false;
            } else {
              map.removeLayer(planeMarker);
              planeMarker = null;
              planeIndex = 0;
              currentStage++;
            }
            break;
          case 3:
            speed = trainSpeed;
            currentPoints = trainPath2Points;
            if (!trainMarker2) {
              trainMarker2 = L.marker(locations[9].coords, { icon: trainIcon }).addTo(map);
            }
            if (trainIndex2 < currentPoints.length - 1) {
              trainIndex2++;
              trainMarker2.setLatLng(currentPoints[trainIndex2]);
              stageFinished = false;
            } else {
              map.removeLayer(trainMarker2);
              trainMarker2 = null;
              trainIndex2 = 0;
              currentStage++;
            }
            break;
          case 4:
            speed = busSpeed;
            currentPoints = busPath2Points;
            if (!busMarker2) {
              busMarker2 = L.marker(locations[0].coords, { icon: busIcon }).addTo(map);
            }
            if (busIndex2 < currentPoints.length - 1) {
              busIndex2++;
              busMarker2.setLatLng(currentPoints[busIndex2]);
              stageFinished = false;
            } else {
              map.removeLayer(busMarker2);
              busMarker2 = null;
              busIndex2 = 0;
              currentStage = 0;
            }
            break;
        }

        if (stageFinished) {
          clearInterval(animationInterval);
          setTimeout(animateStage, 1000);
        }
      }, 20);
    }

    // å®šç¾©è·¯ç·š
    const trainPath1 = [locations[0].coords, locations[1].coords];
    const busPath = locations.slice(1, 9).map(l => l.coords);
    const smoothFlightPath = flightPath;
    const trainPath2 = [locations[9].coords, locations[0].coords];
    const busPath2 = [locations[0].coords, locations[10].coords, locations[0].coords];

    // å•Ÿå‹•å‹•ç•«
    startAnimation();

    // æ·»åŠ ç·šæ¢
    L.polyline([locations[0].coords, locations[1].coords], { color: 'red', weight: 4, dashArray: '2, 10' }).addTo(map);
    L.polyline([locations[9].coords, locations[0].coords], { color: 'purple', weight: 3, dashArray: '5, 10' }).addTo(map);
    L.polyline([locations[10].coords, locations[0].coords], { color: 'green', weight: 3, dashArray: '1, 5' }).addTo(map);

    const summaryText = `çµ²è·¯ä¹‹æ—…_è¡Œç¨‹ç°¡è¡¨ <br>â—D1 5æœˆ30æ—¥ï¼šé„­å· â†’ å¤©æ°´ ï¸<br>æŠµé”é„­å·æ©Ÿå ´ âœˆï¸ï¼Œå‰å¾€é„­å·é«˜éµç«™ ï¼Œæ­é«˜éµå‰å¾€å¤©æ°´ ï¸ã€‚<br>ä½å®¿ï¼šæŸéœ–è‰¾è²é…’åº— ã€‚<br>â—D2 5æœˆ31æ—¥ï¼šå¤©æ°´ â†’ è˜­å· ï¸<br>åƒè§€éº¥ç©å±±çŸ³çªŸ ï¼Œéš¨å¾Œä¹˜è»Šå‰å¾€è˜­å·ã€‚<br>éŠè¦½é»ƒæ²³éŠè¦½å€ ï¸ã€‚<br>ä½å®¿ï¼šè˜­å·é»ƒæ²³ç¾è¯é…’åº— ã€‚<br>â—D3 6æœˆ1æ—¥ï¼šè˜­å· â†’ æ™¯æ³° â†’ æ­¦å¨ ï¸<br>å‰å¾€æ™¯æ³°ï¼Œåƒè§€é»ƒæ²³çŸ³æ— ï¸ã€‚<br>ä¹˜è»Šå‰å¾€æ­¦å¨ ã€‚<br>ä½å®¿ï¼šé‡‘é™µå¤§é…’åº— ã€‚<br>â—D4 6æœˆ2æ—¥ï¼šæ­¦å¨ â†’ å¼µæ– â†’ å˜‰å³ªé—œ <br>æ—©é¤å¾Œä¹˜è»Šå‰å¾€å¼µæ– ï¼Œåƒè§€ä¸ƒå½©ä¸¹éœ ï¸ã€‚<br>å‰å¾€å˜‰å³ªé—œã€‚<br>ä½å®¿ï¼šå˜‰å³ªé—œè«¾é‡‘é…’åº— ã€‚<br>â—D5 6æœˆ3æ—¥ï¼šå˜‰å³ªé—œ â†’ ç“œå· â†’ æ•¦ç…Œ ï¸<br>åƒè§€å˜‰å³ªé—œåŸæ¨“ ã€‚<br>å‰å¾€ç“œå·ï¼Œåƒè§€å¤§åœ°ä¹‹å­å’Œæµ·å¸‚èœƒæ¨“ ã€‚<br>å‰å¾€æ•¦ç…Œï¼Œåƒè§€é™½é—œ ã€‚<br>ä½å®¿ï¼šæ•¦ç…Œä¸­å·åœ‹éš›é…’åº— ã€‚<br>â—D6 6æœˆ4æ—¥ï¼šæ•¦ç…Œ ï¸<br>åƒè§€è«é«˜çªŸ  å’Œé³´æ²™å±±æœˆç‰™æ³‰ ï¸ã€‚<br>æ™šé¤å®‰æ’çƒ¤å…¨ç¾Š ã€‚<br>ä½å®¿ï¼šæ•¦ç…Œä¸­å·åœ‹éš›é…’åº— ã€‚<br>â—D7 6æœˆ5æ—¥ï¼šæ•¦ç…Œ â†’ è¥¿å®‰ âœˆï¸<br>åƒè§€å¤åŸå’Œè¥¿åƒä½›æ´ ã€‚<br>ä¸‹åˆä¹˜é£›æ©Ÿè¿”å›è¥¿å®‰ã€‚<br>ä½å®¿ï¼šè¥¿å®‰çµ¡ç¹¹åŠLFYå…±ç”¨å…¬å¯“ ã€‚<br>â—D8 6æœˆ6æ—¥ï¼šè¥¿å®‰ â†’ é„­å· <br>åƒè§€å…µé¦¬ä¿‘  å’Œé©ªå±± ï¸ã€‚<br>è¡Œç¨‹çµæŸï¼Œé€é«˜éµç«™ ã€‚<br>ä½å®¿ï¼šé„­å·å»ºåœ‹é£¯åº— ã€‚<br>â—D9 6æœˆ7æ—¥ï¼šé„­å· â†’ ç™»å° â†’ é„­å· <br>æ—©é¤å¾Œå‰å¾€å°‘æ—å¯º ï¼Œåƒè§€å¡”æ—å’Œå°‘æ—åŠŸå¤«è¡¨æ¼” ã€‚<br>è¿”å›é„­å·ï¼Œè‡ªç”±è³¼ç‰© ï¸ã€‚<br>ä½å®¿ï¼šé„­å·å»ºåœ‹é£¯åº— ã€‚<br>â—D10 6æœˆ8æ—¥ï¼šé„­å· â†’ è‡ºåŒ— âœˆï¸<br>æ—©é¤å¾Œé€é£›æ©Ÿ ã€‚`;

    const summaryLabel = L.marker([37.5187, 98.5000], {
      icon: L.divIcon({
        className: 'summary-label',
        html: '<div style="background: #F08080; border: 1px solid #666; padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 14px;">è¡Œç¨‹ç°¡è¡¨</div>',
        iconSize: [80, 30],
        iconAnchor: [50, 15]
      })
    }).addTo(map);

    summaryLabel.bindPopup(`<div class='summary-popup' style='width: 420px;'>${summaryText}</div>`);

    summaryLabel.on('click', function() {
      const bounds = L.latLngBounds(locations.map(l => l.coords));
      map.fitBounds(bounds);
    });

    const summaryTextA = `é„­å·â†’å¤©æ°´â†’è˜­å·â†’æ™¯æ³°â†’æ­¦å¨â†’å¼µæ–â†’å˜‰å³ªé—œ<br>â†’ç“œå·â†’æ•¦ç…Œâ†’è¥¿å®‰â†’é„­å·<br><br>â—†é„­å·å•Ÿç¨‹å‘å¤©æ°´ ï¸ï¼Œéº¥ç©ç…™é›¨æ´—ç…©æ†‚ â˜ï¸<br>â—†è˜­å·æ‹‰éºµæš–èƒƒé ­ ï¼Œæ™¯æ³°çŸ³æ—ç•«ä¸­éŠ ï¸<br>â—†æ­¦å¨è¹„è²è¸é¢¨èµ° ï¼Œå¼µæ–ä¸¹éœæŠ«å½©ç¶¢ <br>â—†å˜‰å³ªé›„é—œé®é‚Šé™² ï¼Œç“œå·èœœç“œç”œå¿ƒå–‰ <br>â—†æ•¦ç…Œé£›å¤©èˆçµ²è·¯ ï¸ï¼Œé•·å®‰ç‡ˆç«æ˜ é¼“æ¨“ <br>â—†ç¹è¡Œåƒé‡Œæ­¸é„­å¾Œ ï¼Œå¤§æ¼ é¢¨æƒ…å¿ƒåº•ç•™ ï¸`;

    const summaryLabelA = L.marker([36.5187, 98.5000], {
      icon: L.divIcon({
        className: 'summary-labelA',
        html: '<div style="background:#FFFFCC; border: 1px solid #666; padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 12px;">ã€Šè¥¿éŠç¹å£ä»¤ã€‹</div>',
        iconSize: [110, 30],
        iconAnchor: [50, 15]
      })
    }).addTo(map);

    summaryLabelA.bindPopup(`<div class='summary-labelA-popup'>${summaryTextA}</div>`);

  </script>
</body>
</html>
